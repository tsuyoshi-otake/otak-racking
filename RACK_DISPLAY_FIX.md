# ラック表示問題の修正

## 問題の概要

ユーザーから報告された問題：
- 33-34Uに2Uサーバーが設置されているのに、35Uが未設置として表示されている状況

## 問題の原因

### 1. 表示ロジックの不整合
- 2Uサーバーの拡張ユニット（isMainUnit: false）は薄く表示される
- 空のユニットは通常の空きユニット表示
- この違いにより、占有状況が不明確

### 2. ユニット番号の理解不足
- ラックユニット番号は下から上に1から始まる
- 33-34Uに設置 = 33U（下）+ 34U（上）を占有
- 35Uは独立した空きユニット

## 実装した修正

### 1. RackView.tsx の表示改善

#### ユニット状態の明確化
```typescript
// メイン機器の参照を明確にする
const mainEquipment = isMainUnit ? item : 
  (item ? rack.equipment[item.startUnit || unit] : null);
```

#### 拡張ユニットの視覚的表示
```typescript
// 背景色で占有状況を明確にする
style={{ 
  backgroundColor: item && !isMainUnit ? `${item.color}40` : undefined // 透明度40%
}}
```

#### 拡張ユニットのラベル表示
```typescript
{item && !isMainUnit && (
  <span className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
    ↑{mainEquipment?.name || '機器'}の一部
  </span>
)}
```

### 2. 表示の改善点

#### Before（修正前）
```
35U [  空きユニット  ] ← 通常の空き表示
34U [  薄い表示    ] ← isMainUnit: false で薄く表示
33U [ 2Uサーバー   ] ← isMainUnit: true で濃く表示
```

#### After（修正後）
```
35U [  空きユニット      ] ← 通常の空き表示（変更なし）
34U [ ↑2Uサーバーの一部 ] ← 拡張ユニットであることを明記
33U [ 2Uサーバー        ] ← メインユニット（変更なし）
```

## 修正内容の詳細

### 1. コンポーネント修正

#### src/components/RackView.tsx
- **行328-333**: メイン機器参照の追加
- **行407-409**: 背景色による占有表示
- **行438-442**: 拡張ユニットラベルの追加

### 2. 表示の一貫性

#### 占有状況の明確化
- **メインユニット**: フルカラー表示 + 機器名
- **拡張ユニット**: 薄いカラー表示 + "↑機器名の一部"
- **空きユニット**: 空き表示（変更なし）

#### クリック動作の改善
```typescript
onClick={() => {
  if (item && selectedRack !== 'all') {
    onEquipmentClick?.(mainEquipment || item); // メイン機器を参照
  }
}}
```

## 検証方法

### 1. 手動テスト
1. 33-34Uに2Uサーバーを設置
2. 表示結果を確認：
   - 33U: "2Uサーバー" と表示
   - 34U: "↑2Uサーバーの一部" と表示
   - 35U: 空きユニットとして表示

### 2. 複数機器テスト
1. 1-2Uに2Uサーバー1を設置
2. 4-5Uに2Uサーバー2を設置
3. 各機器の拡張ユニットに適切なラベルが表示されることを確認

### 3. ダークモードテスト
1. ダークモードに切り替え
2. 表示の可読性を確認

## 今後の改善案

### 1. 視覚的改善
- 拡張ユニットに斜線パターンやグラデーション
- ホバー時の機器全体ハイライト

### 2. インタラクション改善
- 拡張ユニットクリック時のメイン機器フォーカス
- 機器全体の選択状態表示

### 3. アクセシビリティ
- スクリーンリーダー対応
- キーボードナビゲーション

## 結論

この修正により、2Uサーバーの占有状況が明確に表示され、ユーザーの混乱を解消しました。特に：

1. **占有状況の明確化**: 拡張ユニットに「↑機器名の一部」を表示
2. **視覚的な改善**: 背景色による占有状態の表現
3. **操作の一貫性**: 拡張ユニットクリック時もメイン機器を参照

これにより、33-34Uに設置された2Uサーバーと、35Uの空きユニットが明確に区別されるようになりました。