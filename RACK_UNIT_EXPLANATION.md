# ラックユニット番号システムの説明

## ユニット番号の基本概念

### 標準的なラックユニット番号付け
ラックのユニット番号は**下から上に向かって1から始まります**。これはデータセンターやサーバールームの国際標準です。

```
42U ┌─────────┐ ← 最上部（42番目のユニット）
41U ├─────────┤
40U ├─────────┤
39U ├─────────┤
    │   ...   │
 4U ├─────────┤
 3U ├─────────┤
 2U ├─────────┤
 1U └─────────┘ ← 最下部（1番目のユニット、床に最も近い）
```

### 35Uと34Uの違い

**位置の違い:**
- **34U**: 下から34番目のユニット（床からより近い）
- **35U**: 下から35番目のユニット（床からより遠い、34Uの上）

**物理的な関係:**
```
35U ┌─────────┐ ← より高い位置
34U └─────────┘ ← より低い位置（床に近い）
```

### なぜこの番号付けなのか？

1. **重力の考慮**: 重い機器は下部に配置するのが安全
2. **アクセス性**: よく使用する機器は手の届きやすい下部に
3. **冷却効率**: 熱い機器を上部に配置し、自然対流を活用
4. **国際標準**: EIA-310規格に準拠

### 機器設置時の考慮点

**2Uサーバーの例:**
- 1-2Uに設置: ユニット1（下）とユニット2（上）を占有
- 34-35Uに設置: ユニット34（下）とユニット35（上）を占有

**高さ方向の関係:**
```
設置例: 2Uサーバーを34-35Uに配置
35U ┌─────────┐ ← サーバーの上半分
34U └─────────┘ ← サーバーの下半分（メインユニット）
33U （空き）
```

### OTAKシステムでの実装

**ユニット管理:**
```typescript
// 2Uサーバーを34Uから設置する場合
const server2U = {
  startUnit: 34,  // 開始ユニット（より低い番号）
  endUnit: 35,    // 終了ユニット（より高い番号）
  height: 2       // 高さ
};

// 各ユニットでの設定
rack.equipment[34] = { ...server2U, isMainUnit: true };   // メインユニット
rack.equipment[35] = { ...server2U, isMainUnit: false };  // 拡張ユニット
```

**占有チェック:**
```typescript
// 34-35Uに機器があるかチェック
for (let unit = 34; unit <= 35; unit++) {
  if (rack.equipment[unit]) {
    // このユニットは占有されている
  }
}
```

### 視覚的な理解

**UIでの表示:**
```
┌─ Unit 35 ─┐  ← より上（画面上部）
│  Server   │
│  (2U)     │
├─ Unit 34 ─┤  ← より下（画面下部、床に近い）
│           │
└───────────┘
```

### よくある混乱

❌ **間違った理解:**
- "35Uの方が下にある"
- "番号が大きい方が床に近い"

✅ **正しい理解:**
- "35Uの方が上にある（床から遠い）"
- "番号が小さい方が床に近い"
- "1Uが最下部、42Uが最上部"

### 実際の設置例

**シナリオ: 2Uサーバーを2台設置**

1. **最初のサーバー**: 3-4Uに設置
   ```
   4U ┌─────────┐ ← サーバー1の上半分
   3U └─────────┘ ← サーバー1の下半分（メイン）
   2U （空き）
   1U （空き）
   ```

2. **2番目のサーバー**: 1-2Uに設置可能
   ```
   4U ┌─────────┐ ← サーバー1の上半分
   3U └─────────┘ ← サーバー1の下半分
   2U ┌─────────┐ ← サーバー2の上半分
   1U └─────────┘ ← サーバー2の下半分（メイン）
   ```

### 新しい設置システムでの改善

我々の新しい`EquipmentPlacementManager`では、このユニット番号の関係を正しく管理し、以下を保証します：

1. **正確な占有チェック**: startUnit ≤ endUnitの関係を維持
2. **適切なメインユニット設定**: より小さい番号（下部）をメインとする
3. **一貫性のある削除**: 関連する全ユニットを正しくクリア

この理解により、ラック内での機器配置がより明確になり、設置ミスを防ぐことができます。